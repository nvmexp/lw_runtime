MACRO(ADD_TORCH_WRAP target luafile)
  INCLUDE_DIRECTORIES("${CMAKE_LWRRENT_BINARY_DIR}")
  GET_FILENAME_COMPONENT(_file_ "${luafile}" NAME_WE)
  SET(cfile "${_file_}.c")
  IF (DEFINED CWRAP_LWSTOM_LUA)
    ADD_LWSTOM_COMMAND(
	OUTPUT "${CMAKE_LWRRENT_BINARY_DIR}/${cfile}"
	COMMAND ${CWRAP_LWSTOM_LUA} ARGS "${CMAKE_LWRRENT_SOURCE_DIR}/${luafile}" "${CMAKE_LWRRENT_BINARY_DIR}/${cfile}"
    	WORKING_DIRECTORY "${CMAKE_LWRRENT_SOURCE_DIR}"
    	DEPENDS "${luafile}")
  ELSE (DEFINED CWRAP_LWSTOM_LUA)
    ADD_LWSTOM_COMMAND(
	OUTPUT "${CMAKE_LWRRENT_BINARY_DIR}/${cfile}"
      	COMMAND @LUA@ ARGS "${CMAKE_LWRRENT_SOURCE_DIR}/${luafile}" "${CMAKE_LWRRENT_BINARY_DIR}/${cfile}"
      	WORKING_DIRECTORY "${CMAKE_LWRRENT_SOURCE_DIR}"
      	DEPENDS "${luafile}")
  ENDIF (DEFINED CWRAP_LWSTOM_LUA)
  ADD_LWSTOM_TARGET(${target} DEPENDS "${CMAKE_LWRRENT_BINARY_DIR}/${cfile}")
ENDMACRO(ADD_TORCH_WRAP)
