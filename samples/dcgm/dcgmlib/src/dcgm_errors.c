#include "dcgm_errors.h"

#define DCGM_ERROR_TABLE_ENTRY(errCode, severity) {errCode, errCode##_MSG, errCode##_NEXT, severity}

dcgm_error_meta_t dcgmErrorMeta[DCGM_FR_ERROR_SENTINEL] =
{
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_OK, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_UNKNOWN, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_UNRECOGNIZED, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_PCI_REPLAY_RATE, DCGM_ERROR_ISOLATE),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_VOLATILE_DBE_DETECTED, DCGM_ERROR_ISOLATE),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_VOLATILE_SBE_DETECTED, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_PENDING_PAGE_RETIREMENTS, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_RETIRED_PAGES_LIMIT, DCGM_ERROR_ISOLATE),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_RETIRED_PAGES_DBE_LIMIT, DCGM_ERROR_ISOLATE),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_CORRUPT_INFOROM, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_CLOCK_THROTTLE_THERMAL, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_POWER_UNREADABLE, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_CLOCK_THROTTLE_POWER, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_LWLINK_ERROR_THRESHOLD, DCGM_ERROR_ISOLATE),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_LWLINK_DOWN, DCGM_ERROR_ISOLATE),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_LWSWITCH_FATAL_ERROR, DCGM_ERROR_ISOLATE),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_LWSWITCH_NON_FATAL_ERROR, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_LWSWITCH_DOWN, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_NO_ACCESS_TO_FILE, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_LWML_API, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_DEVICE_COUNT_MISMATCH, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_BAD_PARAMETER, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_CANNOT_OPEN_LIB, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_BLACKLISTED_DRIVER, DCGM_ERROR_ISOLATE),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_LWML_LIB_BAD, DCGM_ERROR_ISOLATE),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_GRAPHICS_PROCESSES, DCGM_ERROR_ISOLATE),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_HOSTENGINE_CONN, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_FIELD_QUERY, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_BAD_LWDA_ELW, DCGM_ERROR_ISOLATE),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_PERSISTENCE_MODE, DCGM_ERROR_ISOLATE),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_LOW_BANDWIDTH, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_HIGH_LATENCY, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_CANNOT_GET_FIELD_TAG, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_FIELD_VIOLATION, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_FIELD_THRESHOLD, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_FIELD_VIOLATION_DBL, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_FIELD_THRESHOLD_DBL, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_UNSUPPORTED_FIELD_TYPE, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_FIELD_THRESHOLD_TS, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_FIELD_THRESHOLD_TS_DBL, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_THERMAL_VIOLATIONS, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_THERMAL_VIOLATIONS_TS, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_TEMP_VIOLATION, DCGM_ERROR_ISOLATE),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_THROTTLING_VIOLATION, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_INTERNAL, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_PCIE_GENERATION, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_PCIE_WIDTH, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_ABORTED, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_TEST_DISABLED, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_CANNOT_GET_STAT, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_STRESS_LEVEL, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_LWDA_API, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_FAULTY_MEMORY, DCGM_ERROR_ISOLATE),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_CANNOT_SET_WATCHES, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_LWDA_UNBOUND, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_ECC_DISABLED, DCGM_ERROR_ISOLATE),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_MEMORY_ALLOC, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_LWDA_DBE, DCGM_ERROR_ISOLATE),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_MEMORY_MISMATCH, DCGM_ERROR_ISOLATE),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_LWDA_DEVICE, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_ECC_UNSUPPORTED, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_ECC_PENDING, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_MEMORY_BANDWIDTH, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_TARGET_POWER, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_API_FAIL, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_API_FAIL_GPU, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_LWDA_CONTEXT, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_DCGM_API, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_CONLWRRENT_GPUS, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_TOO_MANY_ERRORS, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_LWLINK_CRC_ERROR_THRESHOLD, DCGM_ERROR_ISOLATE),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_LWLINK_ERROR_CRITICAL, DCGM_ERROR_ISOLATE),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_ENFORCED_POWER_LIMIT, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_MEMORY_ALLOC_HOST, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_GPU_OP_MODE, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_NO_MEMORY_CLOCKS, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_NO_GRAPHICS_CLOCKS, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_HAD_TO_RESTORE_STATE, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_L1TAG_UNSUPPORTED, DCGM_ERROR_MONITOR),
    DCGM_ERROR_TABLE_ENTRY(DCGM_FR_L1TAG_MISCOMPARE, DCGM_ERROR_ISOLATE),
};

dcgmErrorSeverity_t dcgmErrorGetPriorityByCode(unsigned int code)
{
    if (code >= DCGM_FR_ERROR_SENTINEL)
    {
        return DCGM_ERROR_UNKNOWN;
    }
    else
    {
        return dcgmErrorMeta[code].severity;
    }
}

const char *dcgmErrorGetFormatMsgByCode(unsigned int code)
{
    if (code >= DCGM_FR_ERROR_SENTINEL)
    {
        return 0;
    }
    else
    {
        return dcgmErrorMeta[code].msgFormat;
    }
}

