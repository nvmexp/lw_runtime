#*****************************************************************************
# Copyright 2019 LWPU Corporation. All rights reserved.
#*****************************************************************************

NEEDS_LWDA  := yes
NEEDS_LWDNN := yes

include ../../../base/system/main/Premake.mk

ifdef LINUX
BUILD_SSIM := yes
endif

ifdef MACOSX
BUILD_SSIM := yes
endif

ifdef WIN_NT
ifdef NT_VC14_OR_HIGHER
BUILD_SSIM := yes
endif
endif

ifdef BUILD_SSIM

SRC :=  \
	fp16_dev.lw \
	fp16_emu.cpp \
	layerdata.cpp \
    ssim_impl.cpp \
	split.cpp \
	forward.lw \
	model.lw \
	model_in.lw \
	model_out.lw

TRAINING_INPUT := \
	trainssim.bin

ifdef AUTOVCPROJ_RUN
BIN2C_INPUTS := $(TRAINING_INPUT)
else
BIN2C_INPUTS := $(foreach f,$(TRAINING_INPUT),$(MI_SRC)/$(TREE)/$(SUBSYS)/$(MOD)/$f)
endif

BIN2C_OUTPUT := $(TARGET)/generated_training_data.h
DEP_AUTOGENERATED_HEADERS += $(BIN2C_OUTPUT)
include ../../../base/system/main/bin2c.mk

DEFS                    += -DIRAY_BUILD
VCPROJ_EXTRA_CFLAGS     += -DIRAY_BUILD
LWCC_FLAGS              += -DIRAY_BUILD

LWCC_INC += -I$(if $(AUTOVCPROJ_RUN),$$(IntDir),$(TARGET))

#lwdnn includes
LWCC_FLAGS += -I $(LWDNN_BASEPATH)/include

# target architecture settings
LWCC_FLAGS += -gencode arch=compute_30,code=sm_30
LWCC_FLAGS += -gencode arch=compute_35,code=sm_35
LWCC_FLAGS += -gencode arch=compute_50,code=sm_50
LWCC_FLAGS += -gencode arch=compute_52,code=sm_52
LWCC_FLAGS += -gencode arch=compute_60,code=sm_60
LWCC_FLAGS += -gencode arch=compute_61,code=sm_61
LWCC_FLAGS += -gencode arch=compute_70,code=sm_70
LWCC_FLAGS += -gencode arch=compute_75,code=sm_75


endif #BUILD_SSIM

include ../../../base/system/main/Postmake.mk
