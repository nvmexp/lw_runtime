/* _LWRM_COPYRIGHT_BEGIN_
 *
 * Copyright 2018 by LWPU Corporation.  All rights reserved.  All information
 * contained herein is proprietary and confidential to LWPU Corporation.  Any
 * use, reproduction, or disclosure without the written permission of LWPU
 * Corporation is prohibited.
 *
 * _LWRM_COPYRIGHT_END_
 */

//*****************************************************
//
// clktu106.c - TU106 Clock lwwatch routines 
// 
//*****************************************************
#include "os.h"
#include "hal.h"
#include "clk.h"
#include "print.h"
#include "turing/tu106/dev_trim.h"
#include "turing/tu106/dev_trim_addendum.h"
#include "ctrl/ctrl2080/ctrl2080clk.h"

#include "g_clk_private.h"           // (rmconfig) implementation prototypes.

/*!
 * @brief Set TCLKOUT source for given clock domain
 *
 * @param[in]   clkDomain   Clock domain LW2080_CTRL_CLK_DOMAIN_XX
 * @param[in]   srcIdx      Clock source index
 *
 * Generated by get_clk_domain_prog_seq_from_tclkout_pm.pl on 
 * chips_a/drivers/common/inc/hwref/<chip_family>/<chip>/tclkout_id.pm.
 * Refer https://confluence.lwpu.com/pages/viewpage.action?spaceKey=GPUC&title=TCLKOUT+Programming+Guide
 * for details.
 *
 * TODO: Auto generation of below chip specific source code by lwwatch-config
 */
LW_STATUS
clkSetSourceCntr_TU106
(
    LwU32 clkDomain,
    LwU32 srcIdx
)
{
    switch (clkDomain)
    {
        case LW2080_CTRL_CLK_DOMAIN_GPCCLK:
        {
            switch (srcIdx)
            {
                case 0:
                    GPU_REG_WR32(LW_PTRIM_GPC_TCLKOUT_CTRL_GPC(srcIdx), 0x01030101);
                    GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_XBAR, 0x01020201);
                    GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_SYS, 0x010a0101);
                    break;
                case 1:
                    GPU_REG_WR32(LW_PTRIM_GPC_TCLKOUT_CTRL_GPC(srcIdx), 0x01030101);
                    GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_XBAR, 0x01010201);
                    GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_SYS, 0x010a0101);
                    break;
                case 2:
                    GPU_REG_WR32(LW_PTRIM_GPC_TCLKOUT_CTRL_GPC(srcIdx), 0x01030101);
                    GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_XBAR, 0x01010301);
                    GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_SYS, 0x010a0101);
                    break;
                default:
                    dprintf("lw: ERROR: clk Domain %x source %x not configured \n", clkDomain, srcIdx);
                    return LW_ERR_NOT_SUPPORTED;
            }
            break;
        }
        case LW2080_CTRL_CLK_DOMAIN_XBARCLK:
            GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_XBAR, 0x01030201);
            GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_SYS, 0x010a0101);
            break;
        case LW2080_CTRL_CLK_DOMAIN_SYSCLK:
            GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_SYS, 0x010d0301);
            break;
        case LW2080_CTRL_CLK_DOMAIN_HUBCLK:
            GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_SYS, 0x010d0201);
            break;
        case LW2080_CTRL_CLK_DOMAIN_MCLK:
        {
            switch (srcIdx)
            {
                case 0:
                    GPU_REG_WR32(LW_PTRIM_FBPA_TCLKOUT_CTRL_FBP(srcIdx), 0x01020204);
                    GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_XBAR, 0x01040201);
                    GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_SYS, 0x010a0101);
                    break;
                case 1:
                    GPU_REG_WR32(LW_PTRIM_FBPA_TCLKOUT_CTRL_FBP(srcIdx), 0x01020204);
                    GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_XBAR, 0x01020101);
                    GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_SYS, 0x010a0101);
                    break;
                case 2:
                    GPU_REG_WR32(LW_PTRIM_FBPA_TCLKOUT_CTRL_FBP(srcIdx), 0x01020204);
                    GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_XBAR, 0x01010101);
                    GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_SYS, 0x010a0101);
                    break;
                case 3:
                    GPU_REG_WR32(LW_PTRIM_FBPA_TCLKOUT_CTRL_FBP(srcIdx), 0x01020204);
                    GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_XBAR, 0x01030401);
                    GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_SYS, 0x010a0101);
                    break;
                default:
                    dprintf("lw: ERROR: clk Domain %x source %x not configured \n", clkDomain, srcIdx);
                    return LW_ERR_NOT_SUPPORTED;
            }
            break;
        }
        case LW2080_CTRL_CLK_DOMAIN_HOSTCLK:
            GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_SYS, 0x010d0101);
            break;
        case LW2080_CTRL_CLK_DOMAIN_DISPCLK:
            GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_SYS, 0x01060301);
            break;
        case LW2080_CTRL_CLK_DOMAIN_UTILSCLK:
            GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_SYS, 0x01090201);
            break;
        case LW2080_CTRL_CLK_DOMAIN_PWRCLK:
            GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_SYS, 0x01050101);
            break;
        case LW2080_CTRL_CLK_DOMAIN_LWDCLK:
            GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_SYS, 0x01040101);
            break;
        case LW2080_CTRL_CLK_DOMAIN_VCLK0:
            if (srcIdx == 0)
            {
                GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_SYS, 0x0103011b);
            }
            else if (srcIdx == 1)
            {
                GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_SYS, 0x0103011c);
            }
            else if (srcIdx == 2)
            {
                GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_SYS, 0x0103011d);
            }
            else if (srcIdx == 3)
            {
                GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_SYS, 0x0103011e);
            }
            else
            {
                dprintf("lw: ERROR: clk Domain %x source %x not configured \n", clkDomain, srcIdx);
                return LW_ERR_NOT_SUPPORTED;
            }
            break;
        case LW2080_CTRL_CLK_SOURCE_SPPLL0:
            if (srcIdx == 0)    // SPPLL0
            {
                GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_SYS, 0x010d0f17);
            }
            else if (srcIdx == 1)   // SPPLL1
            {
                GPU_REG_WR32(LW_PTRIM_SYS_TCLKOUT_CTRL_SYS, 0x010d0f18);
            }
            else
            {
                dprintf("lw: ERROR: clk Domain %x source %x not configured \n", clkDomain, srcIdx);
                return LW_ERR_NOT_SUPPORTED;
            }
            break;
        default:
        {
            dprintf("lw: ERROR: clk Domain %x source %x not configured \n", clkDomain, srcIdx);
            return LW_ERR_NOT_SUPPORTED;
            break;
        }
    }

    return LW_OK;
}
